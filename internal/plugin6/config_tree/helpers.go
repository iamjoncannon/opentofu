package config_tree

import (
	"strings"

	"github.com/hashicorp/hcl/v2"
	"github.com/opentofu/opentofu/internal/addrs"
	"github.com/opentofu/opentofu/internal/configs"
	tf_core_config "github.com/opentofu/opentofu/internal/configs"
	"github.com/opentofu/opentofu/internal/configs/configload"
	"github.com/opentofu/opentofu/internal/tfplugin6"
)

func (c *DemoConfigTreeBuilder) new_main_module_instance_node(module configs.Module) ModuleInstanceNode {

	get_blank_range := func() hcl.Range {
		return hcl.Range{Filename: "", Start: hcl.Pos{0, 0, 0}, End: hcl.Pos{0, 0, 0}}
	}

	main_config_struct := configs.Config{
		Root:            nil,
		Parent:          nil,
		Path:            addrs.Module{},
		Children:        make(map[string]*configs.Config),
		Module:          &module,
		CallRange:       get_blank_range(),
		SourceAddr:      nil,
		SourceAddrRaw:   "",
		SourceAddrRange: get_blank_range(),
		Version:         nil,
	}

	main_config_struct.Root = &main_config_struct

	return main_config_struct
}

func (c *DemoConfigTreeBuilder) new_module_instance_node(
	module_class *tf_core_config.Module,
	module_instance_path []string,
	call_range hcl.Range,
) *tf_core_config.Config {

	main_config_struct := configs.Config{ // a wrapper for the instance, not class
		Root:            c.RootModuleInstanceNode,
		Parent:          nil,
		Path:            module_instance_path, // module.network_east instance path
		Children:        make(map[string]*configs.Config),
		Module:          module_class,                            // the module class
		CallRange:       call_range,                              // call range for the parent ModuleCall Block
		SourceAddr:      nil,                                     // folder location of the module class
		SourceAddrRaw:   strings.Join(module_instance_path, "/"), // folder location of the module class
		SourceAddrRange: call_range,                              // field on the module call with folder location
		Version:         nil,
	}

	return &main_config_struct
}

/*

snapshotModule for main

&{
	Dir:. 								// directory for main is "."

	Files:map[
		globals.tf:[10 118 97 114 105 97 98 108 101 32 34 112 117 98 108 105 99 95 115 117 98 110 101 116 95 99 105 100 114 115 34 32 123 10 32 32 100 101 102 97 117 108 116 32 61 32 91 34 49 48 46 48 46 49 46 48 47 50 52 34 44 32 34 49 48 46 48 46 50 46 48 47 50 52 34 44 32 34 49 48 46 48 46 51 46 48 47 50 52 34 93 10 125 10 10 118 97 114 105 97 98 108 101 32 34 112 114 105 118 97 116 101 95 115 117 98 110 101 116 95 99 105 100 114 115 34 32 123 10 32 32 100 101 102 97 117 108 116 32 61 32 91 34 49 48 46 48 46 52 46 48 47 50 52 34 44 32 34 49 48 46 48 46 53 46 48 47 50 52 34 44 32 34 49 48 46 48 46 54 46 48 47 50 52 34 93 10 125 10] main.tf:[116 101 114 114 97 102 111 114 109 32 123 10 32 32 114 101 113 117 105 114 101 100 95 112 114 111 118 105 100 101 114 115 32 123 10 10 32 32 32 32 97 119 115 32 61 32 123 10 32 32 32 32 32 32 115 111 117 114 99 101 32 32 61 32 34 104 97 115 104 105 99 111 114 112 47 97 119 115 34 10 32 32 32 32 32 32 118 101 114 115 105 111 110 32 61 32 34 51 46 55 52 46 48 34 10 32 32 32 32 125 10 10 32 32 125 10 125 10 10 10 109 111 100 117 108 101 32 34 110 101 116 119 111 114 107 95 119 101 115 116 34 32 123 10 32 32 115 111 117 114 99 101 32 61 32 34 46 47 109 111 100 117 108 101 115 47 110 101 116 119 111 114 107 105 110 103 34 10 32 32 98 97 115 101 95 99 105 100 114 95 98 108 111 99 107 32 61 32 34 49 48 46 48 46 48 46 48 47 50 50 34 10 32 32 112 117 98 108 105 99 95 115 117 98 110 101 116 95 99 105 100 114 115 32 61 32 118 97 114 46 112 117 98 108 105 99 95 115 117 98 110 101 116 95 99 105 100 114 115 10 32 32 112 114 105 118 97 116 101 95 115 117 98 110 101 116 95 99 105 100 114 115 32 61 32 118 97 114 46 112 114 105 118 97 116 101 95 115 117 98 110 101 116 95 99 105 100 114 115 10 32 32 114 101 103 105 111 110 32 61 32 34 117 115 45 119 101 115 116 45 49 34 10 10 32 32 112 114 111 118 105 100 101 114 115 32 61 32 123 10 32 32 32 32 97 119 115 32 61 32 97 119 115 46 119 101 115 116 10 32 32 125 10 125 10 10 109 111 100 117 108 101 32 34 110 101 116 119 111 114 107 95 101 97 115 116 34 32 123 10 32 32 115 111 117 114 99 101 32 61 32 34 46 47 109 111 100 117 108 101 115 47 110 101 116 119 111 114 107 105 110 103 34 10 32 32 98 97 115 101 95 99 105 100 114 95 98 108 111 99 107 32 61 32 34 49 48 46 48 46 48 46 48 47 50 50 34 10 32 32 112 117 98 108 105 99 95 115 117 98 110 101 116 95 99 105 100 114 115 32 61 32 118 97 114 46 112 117 98 108 105 99 95 115 117 98 110 101 116 95 99 105 100 114 115 10 32 32 112 114 105 118 97 116 101 95 115 117 98 110 101 116 95 99 105 100 114 115 32 61 32 118 97 114 46 112 114 105 118 97 116 101 95 115 117 98 110 101 116 95 99 105 100 114 115 10 32 32 114 101 103 105 111 110 32 61 32 34 117 115 45 101 97 115 116 45 49 34 10 32 32 112 114 111 118 105 100 101 114 115 32 61 32 123 10 32 32 32 32 97 119 115 32 61 32 97 119 115 46 101 97 115 116 10 32 32 125 10 125 10]
		providers.tf:[112 114 111 118 105 100 101 114 32 34 97 119 115 34 32 123 10 32 32 97 108 105 97 115 32 32 32 32 32 61 32 34 101 97 115 116 34 10 32 32 114 101 103 105 111 110 32 32 32 32 32 61 32 34 117 115 45 101 97 115 116 45 49 34 10 32 32 97 99 99 101 115 115 95 107 101 121 32 61 32 34 65 75 73 65 85 69 66 78 53 68 86 84 78 51 84 84 67 51 85 52 34 10 32 32 115 101 99 114 101 116 95 107 101 121 32 61 32 34 99 86 114 57 47 119 88 82 112 107 68 47 116 43 56 72 54 50 57 115 102 71 69 117 105 74 101 113 80 54 113 67 100 109 117 81 74 85 76 117 34 10 125 10 10 112 114 111 118 105 100 101 114 32 34 97 119 115 34 32 123 10 32 32 97 108 105 97 115 32 32 32 32 32 61 32 34 119 101 115 116 34 10 32 32 114 101 103 105 111 110 32 32 32 32 32 61 32 34 117 115 45 119 101 115 116 45 49 34 10 32 32 97 99 99 101 115 115 95 107 101 121 32 61 32 34 65 75 73 65 85 69 66 78 53 68 86 84 78 51 84 84 67 51 85 52 34 10 32 32 115 101 99 114 101 116 95 107 101 121 32 61 32 34 99 86 114 57 47 119 88 82 112 107 68 47 116 43 56 72 54 50 57 115 102 71 69 117 105 74 101 113 80 54 113 67 100 109 117 81 74 85 76 117 34 10 125]]

	SourceAddr:							// SourceAddress is ""

	Version:<nil>
}


snapshotModule network_east and network_west

&{
	Dir:modules/networking 					// Dir is the SourceAddr without the relative file path at the start "./"

	Files:map[
		subnets.tf:[ 46 105 100 10 32 32 99 105 100 114 95 98 108 111 99 107 32 32 32 32 32 32 32 32 32 32 32 32 32 32 61 32 118 97 114 46 112 117 98 108 105 99 95 115 117 98 110 101 116 95 99 105 100 114 115 91 48 93 10 32 32 97 118 97 105 108 97 98 105 108 105 116 121 95 122 111 110 101 32 32 32 32 32 32 32 61 32 34 36 123 118 97 114 46 114 101 103 105 111 110 125 97 34 10 32 32 109 97 112 95 112 117 98 108 105 99 95 105 112 95 111 110 95 108 97 117 110 99 104 32 61 32 116 114 117 101 10 10 32 32 116 97 103 115 32 61 32 123 10 32 32 32 32 34 78 97 109 101 34 32 61 32 34 112 117 98 108 105 99 45 36 123 118 97 114 46 114 101 103 105 111 110 125 97 34 10 32 32 125 10 125 10 10 114 101 115 111 117 114 99 101 32 34 97 119 115 95 115 117 98 110 101 116 34 32 34 112 114 105 118 97 116 101 45 97 34 32 123 10 32 32 118 112 99 95 105 100 32 32 32 32 32 61 32 97 119 115 95 118 112 99 46 109 97 105 110 46 105 100 10 32 32 99 105 100 114 95 98 108 111 99 107 32 61 32 118 97 114 46 112 114 105 118 97 116 101 95 115 117 98 110 101 116 95 99 105 100 114 115 91 48 93 10 10 32 32 97 118 97 105 108 97 98 105 108 105 116 121 95 122 111 110 101 32 61 32 34 36 123 118 97 114 46 114 101 103 105 111 110 125 97 34 10 10 32 32 116 97 103 115 32 61 32 123 10 32 32 32 32 34 78 97 109 101 34 32 61 32 34 112 114 105 118 97 116 101 45 36 123 118 97 114 46 114 101 103 105 111 110 125 97 34 10 32 32 125 10 125 10 10 114 101 115 111 117 114 99 101 32 34 97 119 115 95 115 117 98 110 101 116 34 32 34 112 117 98 108 105 99 45 98 34 32 123 10 32 32 118 112 99 95 105 100 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 61 32 97 119 115 95 118 112 99 46 109 97 105 110 46 105 100 10 32 32 99 105 100 114 95 98 108 111 99 107 32 32 32 32 32 32 32 32 32 32 32 32 32 32 61 32 118 97 114 46 112 117 98 108 105 99 95 115 117 98 110 101 116 95 99 105 100 114 115 91 49 93 10 32 32 97 118 97 105 108 97 98 105 108 105 116 121 95 122 111 110 101 32 32 32 32 32 32 32 61 32 34 36 123 118 97 114 46 114 101 103 105 111 110 125 98 34 10 32 32 109 97 112 95 112 117 98 108 105 99 95 105 112 95 111 110 95 108 97 117 110 99 104 32 61 32 116 114 117 101 10 10 32 32 116 97 103 115 32 61 32 123 10 32 32 32 32 34 78 97 109 101 34 32 61 32 34 112 117 98 108 105 99 45 36 123 118 97 114 46 114 101 103 105 111 110 125 98 34 10 32 32 125 10 125 10 10 114 101 115 111 117 114 99 101 32 34 97 119 115 95 115 117 98 110 101 116 34 32 34 112 114 105 118 97 116 101 45 98 34 32 123 10 32 32 118 112 99 95 105 100 32 32 32 32 32 32 32 32 32 32 32 32 61 32 97 119 115 95 118 112 99 46 109 97 105 110 46 105 100 10 32 32 99 105 100 114 95 98 108 111 99 107 32 32 32 32 32 32 32 32 61 32 118 97 114 46 112 114 105 118 97 116 101 95 115 117 98 110 101 116 95 99 105 100 114 115 91 49 93 10 32 32 97 118 97 105 108 97 98 105 108 105 116 121 95 122 111 110 101 32 61 32 34 36 123 118 97 114 46 114 101 103 105 111 110 125 98 34 10 10 32 32 116 97 103 115 32 61 32 123 10 32 32 32 32 34 78 97 109 101 34 32 61 32 34 112 114 105 118 97 116 101 45 36 123 118 97 114 46 114 101 103 105 111 110 125 98 34 10 32 32 125 10 125 10]
		vpc.tf:[10 118 97 114 105 97 98 108 101 32 34 98 97 115 101 95 99 105 100 114 95 98 108 111 99 107 34 32 123 125 10 118 97 114 105 97 98 108 101 32 34 112 117 98 108 105 99 95 115 117 98 110 101 116 95 99 105 100 114 115 34 32 123 125 10 118 97 114 105 97 98 108 101 32 34 112 114 105 118 97 116 101 95 115 117 98 110 101 116 95 99 105 100 114 115 34 32 123 125 10 118 97 114 105 97 98 108 101 32 34 114 101 103 105 111 110 34 32 123 125 10 10 116 101 114 114 97 102 111 114 109 32 123 10 32 32 114 101 113 117 105 114 101 100 95 112 114 111 118 105 100 101 114 115 32 123 10 10 32 32 32 32 97 119 115 32 61 32 123 10 32 32 32 32 32 32 115 111 117 114 99 101 32 32 61 32 34 104 97 115 104 105 99 111 114 112 47 97 119 115 34 10 32 32 32 32 32 32 118 101 114 115 105 111 110 32 61 32 34 51 46 55 52 46 48 34 10 32 32 32 32 125 10 10 32 32 125 10 125 10 10 114 101 115 111 117 114 99 101 32 34 97 119 115 95 118 112 99 34 32 34 109 97 105 110 34 32 123 10 32 32 99 105 100 114 95 98 108 111 99 107 32 61 32 118 97 114 46 98 97 115 101 95 99 105 100 114 95 98 108 111 99 107 10 125 10 10 114 101 115 111 117 114 99 101 32 34 97 119 115 95 105 110 116 101 114 110 101 116 95 103 97 116 101 119 97 121 34 32 34 109 97 105 110 34 32 123 10 32 32 118 112 99 95 105 100 32 61 32 97 119 115 95 118 112 99 46 109 97 105 110 46 105 100 10 125 10 10]
		]
	SourceAddr:./modules/networking 		// relative path of module path

	Version:<nil>
	}

*/

// generate modulesnapshot for ModuleClass
func (c *DemoConfigTreeBuilder) get_module_snapshot(
	module_instance_path []string,
	module_instance_id ModuleInstanceId,
	module_shards []*tfplugin6.ModuleShard,
) *configload.SnapshotModule {

	file_map := make(map[string][]byte)

	for _, shard := range module_shards {

		name := shard.RawFileContainer.Path
		file := shard.RawFileContainer.Bytes

		file_map[name] = file
	}

	return &configload.SnapshotModule{
		Dir:        strings.Join(module_instance_path, "/"),
		Files:      file_map,
		SourceAddr: strings.Join(module_instance_path, "/"),
		Version:    nil,
	}
}
